# ğŸš€ í”„ë¡œì íŠ¸ ì „ì²´ ê°œì„  ë¶„ì„ ë³´ê³ ì„œ

**í”„ë¡œì íŠ¸**: NAS ë„¤ì´ë²„ ë¶€ë™ì‚° í¬ë¡¤ëŸ¬  
**ë¶„ì„ ë‚ ì§œ**: 2025-10-22  
**ë²„ì „**: v2.10.0

---

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#ê°œìš”)
2. [í”„ë¡œì íŠ¸ í˜„í™© ë¶„ì„](#í”„ë¡œì íŠ¸-í˜„í™©-ë¶„ì„)
3. [ì£¼ìš” ê°œì„  ì˜ì—­](#ì£¼ìš”-ê°œì„ -ì˜ì—­)
4. [ìš°ì„ ìˆœìœ„ë³„ ê°œì„  ê³„íš](#ìš°ì„ ìˆœìœ„ë³„-ê°œì„ -ê³„íš)
5. [ìƒì„¸ ê°œì„  ê°€ì´ë“œ](#ìƒì„¸-ê°œì„ -ê°€ì´ë“œ)
6. [ì˜ˆìƒ íš¨ê³¼](#ì˜ˆìƒ-íš¨ê³¼)

---

## ê°œìš”

### í”„ë¡œì íŠ¸ êµ¬ì¡°

```
Full-Stack ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜
â”œâ”€â”€ Frontend: Next.js 14 + React + TailwindCSS
â”œâ”€â”€ Backend: Next.js API Routes + Prisma ORM
â”œâ”€â”€ Database: PostgreSQL 16
â”œâ”€â”€ Crawler: Python 3.11 + Playwright
â””â”€â”€ Deployment: Docker + Docker Compose
```

### ì£¼ìš” ê¸°ëŠ¥
- ë„¤ì´ë²„ ë¶€ë™ì‚° ìë™ í¬ë¡¤ë§ (ë¬´í•œ ìŠ¤í¬ë¡¤, ì¤‘ë³µ ì œê±°)
- ì‹¤ì‹œê°„ ë§¤ë¬¼ ëª¨ë‹ˆí„°ë§ ë° ì•Œë¦¼
- ì»¤ë®¤ë‹ˆí‹° ì‹œìŠ¤í…œ (ê²Œì‹œíŒ, ëŒ“ê¸€)
- ìŠ¤ì¼€ì¤„ë§ ìë™ í¬ë¡¤ë§
- ë°ì´í„° ë¶„ì„ ë° ì‹œê°í™”

---

## í”„ë¡œì íŠ¸ í˜„í™© ë¶„ì„

### âœ… ì˜ êµ¬í˜„ëœ ë¶€ë¶„

#### 1. ì•„í‚¤í…ì²˜ ë° ê¸°ìˆ  ìŠ¤íƒ
- **í˜„ëŒ€ì ì¸ ê¸°ìˆ  ìŠ¤íƒ**: Next.js 14, Prisma, PostgreSQL ì‚¬ìš©
- **Docker ê¸°ë°˜ ë°°í¬**: ê°œë°œ/í”„ë¡œë•ì…˜ í™˜ê²½ ë¶„ë¦¬
- **ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„**: ì •ê·œí™”ëœ ìŠ¤í‚¤ë§ˆ, ì ì ˆí•œ ì¸ë±ì‹±
- **ì»¤ë®¤ë‹ˆí‹° ì‹œìŠ¤í…œ**: ì™„ì „í•œ ê²Œì‹œíŒ ê¸°ëŠ¥ (ì¢‹ì•„ìš”, ëŒ“ê¸€, ì‹ ê³ )

#### 2. í¬ë¡¤ë§ ì—”ì§„
- **Playwright ê¸°ë°˜**: ì•ˆì •ì ì¸ í—¤ë“œë¦¬ìŠ¤ ë¸Œë¼ìš°ì € í¬ë¡¤ë§
- **ë¬´í•œ ìŠ¤í¬ë¡¤ ì²˜ë¦¬**: ë™ì  ì»¨í…ì¸  ì™„ì „ ìˆ˜ì§‘
- **ì¤‘ë³µ ì œê±° ë¡œì§**: 48% íš¨ìœ¨ ê°œì„ 
- **ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜**: ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ìë™ ë³µêµ¬
- **ì‹¤ì‹œê°„ ì§„í–‰ ìƒíƒœ**: DB ê¸°ë°˜ ì§„í–‰ë¥  ì¶”ì 

#### 3. ë³´ì•ˆ ë° ì¸ì¦
- **NextAuth.js**: ì„¸ì…˜ ê¸°ë°˜ ì¸ì¦
- **ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´**: ADMIN, FAMILY, GUEST ì—­í• 
- **ìŠ¹ì¸ ì‹œìŠ¤í…œ**: ì‹ ê·œ ì‚¬ìš©ì ê´€ë¦¬ì ìŠ¹ì¸ í•„ìš”
- **Rate Limiting**: IP ê¸°ë°˜ ìš”ì²­ ì œí•œ

#### 4. ì„±ëŠ¥ ìµœì í™”
- **ìˆ«ì ê°€ê²© ì»¬ëŸ¼**: BigInt íƒ€ì…ìœ¼ë¡œ ë¹ ë¥¸ ì •ë ¬/í•„í„°ë§
- **ë³µí•© ì¸ë±ìŠ¤**: ìì£¼ ì‚¬ìš©ë˜ëŠ” ì¿¼ë¦¬ ìµœì í™”
- **ì¸ë©”ëª¨ë¦¬ ìºì‹±**: ë°˜ë³µ ì¡°íšŒ ë°ì´í„° ìºì‹±
- **ë°°ì¹˜ ì²˜ë¦¬**: createManyë¡œ ëŒ€ëŸ‰ ë°ì´í„° ì‚½ì…

#### 5. ì‚¬ìš©ì ê²½í—˜
- **ì‹¤ì‹œê°„ ì•Œë¦¼**: SSE ê¸°ë°˜ í¬ë¡¤ë§ ì§„í–‰ ìƒíƒœ
- **Discord ì›¹í›…**: ë§¤ë¬¼ ë³€ë™ ì•Œë¦¼
- **ë°˜ì‘í˜• UI**: ëª¨ë°”ì¼/íƒœë¸”ë¦¿ ì§€ì›
- **ìƒì„¸í•œ ë¬¸ì„œ**: README, CHANGELOG ë“±

---

## ì£¼ìš” ê°œì„  ì˜ì—­

### ğŸ”´ Critical (ì¦‰ì‹œ í•´ê²° í•„ìš”)

#### 1. **í…ŒìŠ¤íŠ¸ ì½”ë“œ ë¶€ì¬** âš ï¸
**í˜„ì¬ ìƒíƒœ**: í…ŒìŠ¤íŠ¸ íŒŒì¼ì´ ì „í˜€ ì—†ìŒ (0% ì»¤ë²„ë¦¬ì§€)

**ë¬¸ì œì **:
- ë¦¬íŒ©í† ë§ ì‹œ íšŒê·€ ë²„ê·¸ ìœ„í—˜
- í”„ë¡œë•ì…˜ ë°°í¬ ì „ í’ˆì§ˆ ê²€ì¦ ë¶ˆê°€
- ì‹ ê·œ ê°œë°œì ì˜¨ë³´ë”© ì–´ë ¤ì›€

**ê°œì„  ë°©ì•ˆ**:
```bash
# í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ ì„¤ì¹˜
npm install --save-dev jest @testing-library/react @testing-library/jest-dom
npm install --save-dev @testing-library/user-event vitest
npm install --save-dev pytest pytest-asyncio pytest-mock  # Python
```

**ì˜ˆì‹œ í…ŒìŠ¤íŠ¸ êµ¬ì¡°**:
```
tests/
â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ auth.test.ts          # ì¸ì¦ ë¡œì§ í…ŒìŠ¤íŠ¸
â”‚   â”‚   â”œâ”€â”€ cache.test.ts         # ìºì‹± ë¡œì§ í…ŒìŠ¤íŠ¸
â”‚   â”‚   â””â”€â”€ rate-limit.test.ts    # Rate limit í…ŒìŠ¤íŠ¸
â”‚   â””â”€â”€ components/
â”‚       â””â”€â”€ CrawlerForm.test.tsx  # ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
â”œâ”€â”€ integration/
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ crawl.test.ts         # í¬ë¡¤ë§ API í†µí•© í…ŒìŠ¤íŠ¸
â”‚       â””â”€â”€ auth.test.ts          # ì¸ì¦ API í…ŒìŠ¤íŠ¸
â””â”€â”€ e2e/
    â””â”€â”€ crawler.test.ts           # E2E í¬ë¡¤ë§ í…ŒìŠ¤íŠ¸
```

**ê¶Œì¥ ì»¤ë²„ë¦¬ì§€ ëª©í‘œ**:
- Unit Tests: 80% ì´ìƒ
- Integration Tests: ì£¼ìš” API ë¼ìš°íŠ¸ 100%
- E2E Tests: í•µì‹¬ ì‚¬ìš©ì í”Œë¡œìš° 3-5ê°œ

---

#### 2. **CI/CD íŒŒì´í”„ë¼ì¸ ì—†ìŒ** âš ï¸
**í˜„ì¬ ìƒíƒœ**: `.github/workflows/` ë””ë ‰í† ë¦¬ ì—†ìŒ

**ë¬¸ì œì **:
- ìˆ˜ë™ ë°°í¬ë¡œ ì¸í•œ íœ´ë¨¼ ì—ëŸ¬
- ì½”ë“œ í’ˆì§ˆ ê²€ì¦ ìë™í™” ë¶€ì¬
- í”„ë¡œë•ì…˜ ë°°í¬ ë¶ˆí™•ì‹¤ì„±

**ê°œì„  ë°©ì•ˆ**:

**`.github/workflows/ci.yml`**:
```yaml
name: CI

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  lint-and-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Lint
        run: npm run lint
      
      - name: Type check
        run: npx tsc --noEmit
      
      - name: Run tests
        run: npm test -- --coverage
      
      - name: Upload coverage
        uses: codecov/codecov-action@v3
        with:
          files: ./coverage/lcov.info

  python-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: Install dependencies
        run: pip install -r requirements.txt
      
      - name: Run pytest
        run: pytest logic/ --cov=logic --cov-report=xml
```

**`.github/workflows/docker-build.yml`**:
```yaml
name: Docker Build

on:
  push:
    branches: [main]
    tags:
      - 'v*'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
      
      - name: Build and test
        run: |
          docker build -t nas-crawler:test .
          docker run --rm nas-crawler:test npm run lint
      
      - name: Tag and push (production only)
        if: startsWith(github.ref, 'refs/tags/')
        run: |
          echo "Build successful for ${{ github.ref }}"
          # í”„ë¡œë•ì…˜ ë ˆì§€ìŠ¤íŠ¸ë¦¬ í‘¸ì‹œ ë¡œì§ ì¶”ê°€
```

---

#### 3. **í™˜ê²½ ë³€ìˆ˜ ë³´ì•ˆ ë¬¸ì œ** ğŸ”’
**í˜„ì¬ ìƒíƒœ**: 
- `config.env` íŒŒì¼ì— ì‹œí¬ë¦¿ í•˜ë“œì½”ë”©
- `INTERNAL_API_SECRET=change-this-to-random-string-in-production`
- Gitì— `.env` íŒŒì¼ ì»¤ë°‹ ê°€ëŠ¥ì„±

**ë¬¸ì œì **:
- ì‹œí¬ë¦¿ ë…¸ì¶œ ìœ„í—˜
- ê°œë°œ/ìŠ¤í…Œì´ì§•/í”„ë¡œë•ì…˜ í™˜ê²½ ê´€ë¦¬ ì–´ë ¤ì›€

**ê°œì„  ë°©ì•ˆ**:

1. **`.env.example` ìƒì„±**:
```bash
# .env.example (ì‹¤ì œ ê°’ ì—†ì´ í…œí”Œë¦¿ë§Œ)
DATABASE_URL=postgresql://user:password@localhost:5432/dbname
NEXTAUTH_SECRET=<generate-with-openssl-rand-base64-32>
INTERNAL_API_SECRET=<generate-with-openssl-rand-base64-32>
NAVER_MAPS_CLIENT_ID=<your-client-id>
NAVER_MAPS_CLIENT_SECRET=<your-client-secret>
```

2. **í™˜ê²½ë³„ ì„¤ì • ë¶„ë¦¬**:
```
.env.local       # ë¡œì»¬ ê°œë°œìš© (git ignore)
.env.development # ê°œë°œ í™˜ê²½
.env.staging     # ìŠ¤í…Œì´ì§• í™˜ê²½
.env.production  # í”„ë¡œë•ì…˜ í™˜ê²½ (git ignore, ì„œë²„ì—ì„œë§Œ ê´€ë¦¬)
```

3. **ì‹œí¬ë¦¿ ê´€ë¦¬ ê°œì„ **:
```typescript
// lib/env.ts
import { z } from 'zod';

const envSchema = z.object({
  DATABASE_URL: z.string().url(),
  NEXTAUTH_SECRET: z.string().min(32),
  INTERNAL_API_SECRET: z.string().min(32),
  NODE_ENV: z.enum(['development', 'production', 'test']),
});

export const env = envSchema.parse(process.env);

// ì‚¬ìš© ì‹œ: env.DATABASE_URL (íƒ€ì… ì•ˆì „)
```

4. **Docker Secrets ì‚¬ìš©** (í”„ë¡œë•ì…˜):
```yaml
# docker-compose.prod.yml
services:
  web:
    secrets:
      - db_password
      - nextauth_secret
secrets:
  db_password:
    external: true
  nextauth_secret:
    external: true
```

---

### ğŸŸ¡ High Priority (ë‹¨ê¸° ê°œì„ )

#### 4. **íƒ€ì… ì•ˆì „ì„± ê°œì„ **
**í˜„ì¬ ë¬¸ì œ**:
```typescript
// âŒ ë‚˜ìœ ì˜ˆ: any íƒ€ì… ì‚¬ìš©
(session.user as any).id = token.id as string;
(session.user as any).role = token.role as 'ADMIN' | 'FAMILY' | 'GUEST';
```

**ê°œì„  ë°©ì•ˆ**:
```typescript
// âœ… ì¢‹ì€ ì˜ˆ: íƒ€ì… í™•ì¥
// types/next-auth.d.ts
import { DefaultSession } from 'next-auth';

declare module 'next-auth' {
  interface Session {
    user: {
      id: string;
      role: 'ADMIN' | 'FAMILY' | 'GUEST';
    } & DefaultSession['user'];
  }

  interface User {
    role: 'ADMIN' | 'FAMILY' | 'GUEST';
  }
}

declare module 'next-auth/jwt' {
  interface JWT {
    id: string;
    role: 'ADMIN' | 'FAMILY' | 'GUEST';
  }
}

// lib/auth.ts
export const authOptions: NextAuthOptions = {
  callbacks: {
    async jwt({ token, user }) {
      if (user) {
        token.id = user.id;
        token.role = user.role; // íƒ€ì… ì•ˆì „
      }
      return token;
    },
    async session({ session, token }) {
      if (session.user) {
        session.user.id = token.id; // íƒ€ì… ì•ˆì „
        session.user.role = token.role; // íƒ€ì… ì•ˆì „
      }
      return session;
    },
  },
};
```

---

#### 5. **ì—ëŸ¬ í•¸ë“¤ë§ í‘œì¤€í™”**
**í˜„ì¬ ë¬¸ì œ**: ê° API ë¼ìš°íŠ¸ë§ˆë‹¤ ì—ëŸ¬ ì²˜ë¦¬ ë°©ì‹ì´ ë‹¤ë¦„

**ê°œì„  ë°©ì•ˆ**:

**`lib/api-response.ts` ê°•í™”**:
```typescript
// í˜„ì¬: ê¸°ë³¸ ì‘ë‹µë§Œ ì²˜ë¦¬
export class ApiResponse {
  static success(data: any, message?: string) { ... }
  static error(error: string, statusCode?: number) { ... }
}

// âœ… ê°œì„ : ì—ëŸ¬ íƒ€ì… ë¶„ë¥˜ ë° ë¡œê¹…
import { createLogger } from '@/lib/logger';

export enum ErrorType {
  VALIDATION = 'VALIDATION_ERROR',
  AUTHENTICATION = 'AUTHENTICATION_ERROR',
  AUTHORIZATION = 'AUTHORIZATION_ERROR',
  NOT_FOUND = 'NOT_FOUND',
  RATE_LIMIT = 'RATE_LIMIT_EXCEEDED',
  INTERNAL = 'INTERNAL_SERVER_ERROR',
  EXTERNAL_API = 'EXTERNAL_API_ERROR',
}

export class ApiError extends Error {
  constructor(
    public type: ErrorType,
    public message: string,
    public statusCode: number,
    public details?: any
  ) {
    super(message);
    this.name = 'ApiError';
  }
}

export class ApiResponse {
  private static logger = createLogger('API');

  static success<T>(data: T, message?: string, meta?: any) {
    return NextResponse.json({
      success: true,
      data,
      message,
      meta,
    });
  }

  static error(
    error: ApiError | Error,
    requestId?: string
  ) {
    const isApiError = error instanceof ApiError;
    
    const statusCode = isApiError ? error.statusCode : 500;
    const errorType = isApiError ? error.type : ErrorType.INTERNAL;
    
    // 500 ì—ëŸ¬ëŠ” ìƒì„¸ ë¡œê·¸ ë‚¨ê¸°ê¸°
    if (statusCode >= 500) {
      this.logger.error('API Error', {
        requestId,
        type: errorType,
        message: error.message,
        stack: error.stack,
        details: isApiError ? error.details : undefined,
      });
    }

    return NextResponse.json(
      {
        success: false,
        error: {
          type: errorType,
          message: error.message,
          ...(isApiError && error.details ? { details: error.details } : {}),
        },
        requestId,
      },
      { status: statusCode }
    );
  }
}

// ì‚¬ìš© ì˜ˆì‹œ
export async function POST(request: NextRequest) {
  const requestId = crypto.randomUUID();
  
  try {
    const body = await request.json();
    
    // Validation
    if (!body.complexNumbers) {
      throw new ApiError(
        ErrorType.VALIDATION,
        'ë‹¨ì§€ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.',
        400,
        { field: 'complexNumbers', received: body }
      );
    }

    // ... ë¡œì§

    return ApiResponse.success(result, 'í¬ë¡¤ë§ ì™„ë£Œ', {
      requestId,
      duration: Date.now() - startTime,
    });

  } catch (error) {
    return ApiResponse.error(
      error instanceof ApiError ? error : new Error(String(error)),
      requestId
    );
  }
}
```

---

#### 6. **ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ìµœì í™”**
**í˜„ì¬ ë¬¸ì œ**: N+1 ì¿¼ë¦¬, ë¶ˆí•„ìš”í•œ ì¡°íšŒ

**ê°œì„  ì‚¬í•­**:

**1. Select ìµœì í™”**:
```typescript
// âŒ ë‚˜ìœ ì˜ˆ: ëª¨ë“  í•„ë“œ ì¡°íšŒ
const complexes = await prisma.complex.findMany();

// âœ… ì¢‹ì€ ì˜ˆ: í•„ìš”í•œ í•„ë“œë§Œ ì¡°íšŒ
const complexes = await prisma.complex.findMany({
  select: {
    id: true,
    complexNo: true,
    complexName: true,
    latitude: true,
    longitude: true,
    _count: {
      select: { articles: true }
    }
  }
});
```

**2. Include ìµœì í™” (N+1 ë¬¸ì œ í•´ê²°)**:
```typescript
// âŒ ë‚˜ìœ ì˜ˆ: N+1 ì¿¼ë¦¬
const posts = await prisma.post.findMany();
for (const post of posts) {
  const author = await prisma.user.findUnique({
    where: { id: post.authorId }
  });
  // N+1 ì¿¼ë¦¬ ë°œìƒ!
}

// âœ… ì¢‹ì€ ì˜ˆ: ë‹¨ì¼ ì¿¼ë¦¬ë¡œ ì¡°ì¸
const posts = await prisma.post.findMany({
  include: {
    author: {
      select: {
        id: true,
        name: true,
        email: true,
      }
    }
  }
});
```

**3. í˜ì´ì§€ë„¤ì´ì…˜ êµ¬í˜„**:
```typescript
// âŒ ë‚˜ìœ ì˜ˆ: ì „ì²´ ì¡°íšŒ
const allArticles = await prisma.article.findMany({
  where: { complexId }
});

// âœ… ì¢‹ì€ ì˜ˆ: ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§€ë„¤ì´ì…˜
export async function getArticles(
  complexId: string,
  cursor?: string,
  limit = 20
) {
  return await prisma.article.findMany({
    where: { complexId },
    take: limit + 1, // +1 for hasMore detection
    ...(cursor && { cursor: { id: cursor }, skip: 1 }),
    orderBy: { createdAt: 'desc' },
  });
}
```

**4. ì¸ë±ìŠ¤ ì¶”ê°€ ì œì•ˆ**:
```prisma
// prisma/schema.prisma

model Article {
  // ... ê¸°ì¡´ í•„ë“œ

  @@index([complexId, createdAt, tradeTypeName]) // ë³µí•© ì¿¼ë¦¬ ìµœì í™”
  @@index([articleConfirmYmd, dealOrWarrantPrcWon]) // ë‚ ì§œë³„ ê°€ê²© ì¡°íšŒ
}

model CrawlHistory {
  // ... ê¸°ì¡´ í•„ë“œ

  @@index([userId, status, startedAt(sort: Desc)]) // ì‚¬ìš©ìë³„ íˆìŠ¤í† ë¦¬
}
```

---

#### 7. **ìºì‹± ì „ëµ ê°œì„ **
**í˜„ì¬ ìƒíƒœ**: ê¸°ë³¸ ì¸ë©”ëª¨ë¦¬ ìºì‹œ (ë‹¨ì¼ ì„œë²„ë§Œ ì§€ì›)

**í”„ë¡œë•ì…˜ ê°œì„  ë°©ì•ˆ**:

**Redis ë„ì…**:
```yaml
# docker-compose.yml
services:
  redis:
    image: redis:7-alpine
    container_name: naver-crawler-redis
    restart: unless-stopped
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    networks:
      - crawler-network

volumes:
  redis_data:
```

**Redis ê¸°ë°˜ ìºì‹± êµ¬í˜„**:
```typescript
// lib/redis-cache.ts
import { createClient } from 'redis';

const redisClient = createClient({
  url: process.env.REDIS_URL || 'redis://localhost:6379'
});

redisClient.on('error', (err) => console.error('Redis Error:', err));
await redisClient.connect();

export async function getCached<T>(
  key: string,
  ttl: number,
  fetcher: () => Promise<T>
): Promise<T> {
  // Redisì—ì„œ ì¡°íšŒ
  const cached = await redisClient.get(key);
  
  if (cached) {
    return JSON.parse(cached);
  }

  // ìºì‹œ ë¯¸ìŠ¤
  const data = await fetcher();
  await redisClient.setEx(key, ttl, JSON.stringify(data));
  
  return data;
}

// ì‚¬ìš© ì˜ˆì‹œ
export async function getComplexStats(complexNo: string) {
  return await getCached(
    `complex:${complexNo}:stats`,
    300, // 5ë¶„ ìºì‹œ
    async () => {
      const articles = await prisma.article.findMany({
        where: { complex: { complexNo } }
      });
      
      return {
        total: articles.length,
        avgPrice: calculateAvgPrice(articles),
        minPrice: Math.min(...articles.map(a => a.dealOrWarrantPrcWon)),
        maxPrice: Math.max(...articles.map(a => a.dealOrWarrantPrcWon)),
      };
    }
  );
}
```

**ìºì‹œ ë¬´íš¨í™” ì „ëµ**:
```typescript
// í¬ë¡¤ë§ ì™„ë£Œ ì‹œ ìºì‹œ ë¬´íš¨í™”
export async function POST(request: NextRequest) {
  // ... í¬ë¡¤ë§ ë¡œì§

  // í¬ë¡¤ë§ëœ ë‹¨ì§€ë“¤ì˜ ìºì‹œ ë¬´íš¨í™”
  for (const complexNo of complexNosArray) {
    await redisClient.del(`complex:${complexNo}:*`);
  }
}
```

---

### ğŸŸ¢ Medium Priority (ì¤‘ê¸° ê°œì„ )

#### 8. **ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹… ì‹œìŠ¤í…œ**
**í˜„ì¬ ìƒíƒœ**: ê¸°ë³¸ì ì¸ ì½˜ì†” ë¡œê·¸ë§Œ ì‚¬ìš©

**ê°œì„  ë°©ì•ˆ**:

**1. êµ¬ì¡°í™”ëœ ë¡œê¹…**:
```typescript
// lib/logger.ts ê°œì„ 
import winston from 'winston';

const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  defaultMeta: { service: 'naver-crawler' },
  transports: [
    new winston.transports.File({ 
      filename: 'logs/error.log', 
      level: 'error' 
    }),
    new winston.transports.File({ 
      filename: 'logs/combined.log' 
    }),
  ],
});

// ê°œë°œ í™˜ê²½ì—ì„œëŠ” ì½˜ì†” ì¶œë ¥ ì¶”ê°€
if (process.env.NODE_ENV !== 'production') {
  logger.add(new winston.transports.Console({
    format: winston.format.simple(),
  }));
}

export function createLogger(context: string) {
  return {
    info: (message: string, meta?: any) => 
      logger.info(message, { context, ...meta }),
    error: (message: string, error?: any) => 
      logger.error(message, { context, error: error?.message, stack: error?.stack }),
    warn: (message: string, meta?: any) => 
      logger.warn(message, { context, ...meta }),
    debug: (message: string, meta?: any) => 
      logger.debug(message, { context, ...meta }),
  };
}
```

**2. APM ë„êµ¬ ë„ì… (Sentry)**:
```typescript
// instrumentation.ts
import * as Sentry from '@sentry/nextjs';

Sentry.init({
  dsn: process.env.SENTRY_DSN,
  environment: process.env.NODE_ENV,
  tracesSampleRate: 1.0,
  profilesSampleRate: 1.0,
  
  beforeSend(event, hint) {
    // ë¯¼ê° ì •ë³´ í•„í„°ë§
    if (event.request?.headers) {
      delete event.request.headers.cookie;
      delete event.request.headers.authorization;
    }
    return event;
  },
});

// API ë¼ìš°íŠ¸ì—ì„œ ì‚¬ìš©
export async function POST(request: NextRequest) {
  const transaction = Sentry.startTransaction({
    op: 'api',
    name: 'POST /api/crawl',
  });

  try {
    // ... ë¡œì§
    
    transaction.setStatus('ok');
  } catch (error) {
    transaction.setStatus('error');
    Sentry.captureException(error);
    throw error;
  } finally {
    transaction.finish();
  }
}
```

**3. í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸ ê°•í™”**:
```typescript
// app/api/health/route.ts
export async function GET() {
  const checks = {
    database: await checkDatabase(),
    redis: await checkRedis(),
    crawler: await checkCrawler(),
    disk: await checkDiskSpace(),
  };

  const healthy = Object.values(checks).every(c => c.status === 'ok');

  return NextResponse.json(
    {
      status: healthy ? 'healthy' : 'degraded',
      timestamp: new Date().toISOString(),
      checks,
    },
    { status: healthy ? 200 : 503 }
  );
}

async function checkDatabase() {
  try {
    await prisma.$queryRaw`SELECT 1`;
    return { status: 'ok', message: 'Database connected' };
  } catch (error) {
    return { status: 'error', message: error.message };
  }
}
```

---

#### 9. **ì½”ë“œ í’ˆì§ˆ ë„êµ¬**
**í˜„ì¬ ìƒíƒœ**: ESLintë§Œ ìˆê³  Prettier, Husky ì—†ìŒ

**ê°œì„  ë°©ì•ˆ**:

**1. Prettier ì„¤ì •**:
```json
// .prettierrc
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 100,
  "tabWidth": 2,
  "useTabs": false,
  "arrowParens": "always"
}
```

**2. ESLint ê°•í™”**:
```json
// .eslintrc.json
{
  "extends": [
    "next/core-web-vitals",
    "plugin:@typescript-eslint/recommended",
    "plugin:react-hooks/recommended",
    "prettier"
  ],
  "rules": {
    "@typescript-eslint/no-explicit-any": "warn",
    "@typescript-eslint/no-unused-vars": ["warn", { 
      "argsIgnorePattern": "^_" 
    }],
    "no-console": ["warn", { 
      "allow": ["warn", "error"] 
    }]
  }
}
```

**3. Husky + lint-staged**:
```json
// package.json
{
  "scripts": {
    "prepare": "husky install"
  },
  "lint-staged": {
    "*.{ts,tsx}": [
      "eslint --fix",
      "prettier --write"
    ],
    "*.{json,md}": [
      "prettier --write"
    ]
  }
}
```

```bash
# .husky/pre-commit
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

npx lint-staged
npm run type-check
```

**4. Python ì½”ë“œ í’ˆì§ˆ**:
```bash
# requirements-dev.txt
black==23.10.0
flake8==6.1.0
mypy==1.6.0
isort==5.12.0
```

```toml
# pyproject.toml
[tool.black]
line-length = 100
target-version = ['py311']

[tool.isort]
profile = "black"
line_length = 100

[tool.mypy]
python_version = "3.11"
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = true
```

---

#### 10. **ì„±ëŠ¥ ìµœì í™”**

**1. Next.js ìµœì í™”**:
```typescript
// next.config.js
const nextConfig = {
  // Strict Mode (ê°œë°œ ì‹œ ë¬¸ì œ ì¡°ê¸° ë°œê²¬)
  reactStrictMode: true,
  
  // SWC ìµœì í™”
  swcMinify: true,
  
  // ì´ë¯¸ì§€ ìµœì í™”
  images: {
    formats: ['image/avif', 'image/webp'],
    deviceSizes: [640, 750, 828, 1080, 1200, 1920],
    minimumCacheTTL: 60,
  },
  
  // ì»´íŒŒì¼ ìµœì í™”
  compiler: {
    removeConsole: process.env.NODE_ENV === 'production' ? {
      exclude: ['error', 'warn'],
    } : false,
  },
  
  // ì›¹íŒ© ìµœì í™”
  webpack: (config, { isServer }) => {
    if (!isServer) {
      config.resolve.fallback = {
        ...config.resolve.fallback,
        fs: false,
        net: false,
        tls: false,
      };
    }
    return config;
  },
};
```

**2. ë²ˆë“¤ í¬ê¸° ë¶„ì„**:
```json
// package.json
{
  "scripts": {
    "analyze": "ANALYZE=true next build"
  }
}
```

```javascript
// next.config.js
const withBundleAnalyzer = require('@next/bundle-analyzer')({
  enabled: process.env.ANALYZE === 'true',
});

module.exports = withBundleAnalyzer(nextConfig);
```

**3. React ì»´í¬ë„ŒíŠ¸ ìµœì í™”**:
```typescript
// âŒ ë‚˜ìœ ì˜ˆ
function ComplexList({ complexes }) {
  return (
    <div>
      {complexes.map(c => <ComplexCard key={c.id} complex={c} />)}
    </div>
  );
}

// âœ… ì¢‹ì€ ì˜ˆ: ë©”ëª¨ì´ì œì´ì…˜
import { memo } from 'react';

const ComplexCard = memo(function ComplexCard({ complex }) {
  // ... ë Œë”ë§ ë¡œì§
});

function ComplexList({ complexes }) {
  return (
    <div>
      {complexes.map(c => <ComplexCard key={c.id} complex={c} />)}
    </div>
  );
}
```

---

### ğŸ”µ Low Priority (ì¥ê¸° ê°œì„ )

#### 11. **êµ­ì œí™” (i18n)**
í–¥í›„ ë‹¤êµ­ì–´ ì§€ì›ì´ í•„ìš”í•œ ê²½ìš°:

```typescript
// next-i18next ì„¤ì¹˜
npm install next-i18next react-i18next i18next

// next-i18next.config.js
module.exports = {
  i18n: {
    defaultLocale: 'ko',
    locales: ['ko', 'en', 'ja'],
  },
};
```

---

#### 12. **ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ë¶„ë¦¬**
ëŒ€ê·œëª¨ í™•ì¥ ì‹œ ê³ ë ¤:

```
í˜„ì¬: Monolith
â””â”€â”€ Next.js (Frontend + API + Crawler)

ë¯¸ë˜: Microservices
â”œâ”€â”€ Frontend Service (Next.js)
â”œâ”€â”€ API Gateway
â”œâ”€â”€ Crawler Service (Python)
â”œâ”€â”€ Notification Service
â””â”€â”€ Analytics Service
```

---

## ìš°ì„ ìˆœìœ„ë³„ ê°œì„  ê³„íš

### Phase 1: Critical (1-2ì£¼)
1. âœ… í…ŒìŠ¤íŠ¸ í™˜ê²½ êµ¬ì¶• (Jest, Vitest, pytest)
2. âœ… CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶• (GitHub Actions)
3. âœ… í™˜ê²½ ë³€ìˆ˜ ë³´ì•ˆ ê°•í™” (.env.example, ì‹œí¬ë¦¿ ê´€ë¦¬)
4. âœ… íƒ€ì… ì•ˆì „ì„± ê°œì„  (NextAuth íƒ€ì… í™•ì¥)

**ì˜ˆìƒ ì‹œê°„**: 40ì‹œê°„  
**ROI**: ë§¤ìš° ë†’ìŒ (ë°°í¬ ì•ˆì •ì„±, ë²„ê·¸ ê°ì†Œ)

---

### Phase 2: High Priority (2-4ì£¼)
5. âœ… ì—ëŸ¬ í•¸ë“¤ë§ í‘œì¤€í™” (ApiError í´ë˜ìŠ¤)
6. âœ… ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ìµœì í™” (N+1 í•´ê²°, ì¸ë±ìŠ¤ ì¶”ê°€)
7. âœ… Redis ìºì‹± ë„ì…
8. âœ… ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ êµ¬ì¶• (Sentry, êµ¬ì¡°í™” ë¡œê¹…)

**ì˜ˆìƒ ì‹œê°„**: 60ì‹œê°„  
**ROI**: ë†’ìŒ (ì„±ëŠ¥ ê°œì„ , ì¥ì•  ëŒ€ì‘)

---

### Phase 3: Medium Priority (4-8ì£¼)
9. âœ… ì½”ë“œ í’ˆì§ˆ ë„êµ¬ (Prettier, Husky, Black)
10. âœ… ì„±ëŠ¥ ìµœì í™” (ë²ˆë“¤ ë¶„ì„, ì»´í¬ë„ŒíŠ¸ ë©”ëª¨ì´ì œì´ì…˜)
11. âœ… API ë¬¸ì„œ ìë™í™” (Swagger/OpenAPI)
12. âœ… ë°±ì—… ë° ë³µêµ¬ ì „ëµ

**ì˜ˆìƒ ì‹œê°„**: 80ì‹œê°„  
**ROI**: ì¤‘ê°„ (ê°œë°œì ê²½í—˜ ê°œì„ )

---

## ìƒì„¸ ê°œì„  ê°€ì´ë“œ

### í…ŒìŠ¤íŠ¸ ì‘ì„± ì˜ˆì‹œ

#### 1. API ë¼ìš°íŠ¸ í…ŒìŠ¤íŠ¸
```typescript
// __tests__/api/crawl.test.ts
import { POST } from '@/app/api/crawl/route';
import { prisma } from '@/lib/prisma';

jest.mock('@/lib/prisma');
jest.mock('child_process');

describe('POST /api/crawl', () => {
  beforeEach(() => {
    jest.clearAllMocks();
  });

  it('should create crawl history', async () => {
    const mockRequest = {
      json: async () => ({ complexNumbers: ['22065'] }),
      headers: new Headers(),
    } as any;

    const response = await POST(mockRequest);
    const data = await response.json();

    expect(response.status).toBe(200);
    expect(data.success).toBe(true);
    expect(prisma.crawlHistory.create).toHaveBeenCalled();
  });

  it('should return 400 for missing complexNumbers', async () => {
    const mockRequest = {
      json: async () => ({}),
      headers: new Headers(),
    } as any;

    const response = await POST(mockRequest);
    const data = await response.json();

    expect(response.status).toBe(400);
    expect(data.error).toContain('ë‹¨ì§€ ë²ˆí˜¸');
  });
});
```

#### 2. ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
```typescript
// __tests__/components/CrawlerForm.test.tsx
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import CrawlerForm from '@/components/CrawlerForm';

describe('CrawlerForm', () => {
  it('should render form elements', () => {
    render(<CrawlerForm />);
    
    expect(screen.getByLabelText(/ë‹¨ì§€ ë²ˆí˜¸/i)).toBeInTheDocument();
    expect(screen.getByRole('button', { name: /í¬ë¡¤ë§ ì‹œì‘/i })).toBeInTheDocument();
  });

  it('should call onSubmit with complex numbers', async () => {
    const onSubmit = jest.fn();
    render(<CrawlerForm onSubmit={onSubmit} />);
    
    const input = screen.getByLabelText(/ë‹¨ì§€ ë²ˆí˜¸/i);
    fireEvent.change(input, { target: { value: '22065' } });
    
    const submitBtn = screen.getByRole('button', { name: /í¬ë¡¤ë§ ì‹œì‘/i });
    fireEvent.click(submitBtn);
    
    await waitFor(() => {
      expect(onSubmit).toHaveBeenCalledWith(['22065']);
    });
  });
});
```

---

### ë°°í¬ ìë™í™”

#### GitHub Actions + Docker Hub
```yaml
# .github/workflows/deploy.yml
name: Deploy to Production

on:
  push:
    tags:
      - 'v*'

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Login to Docker Hub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}
      
      - name: Build and push
        uses: docker/build-push-action@v5
        with:
          context: .
          push: true
          tags: |
            yourname/nas-crawler:latest
            yourname/nas-crawler:${{ github.ref_name }}
      
      - name: Deploy to server
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USERNAME }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            cd /volume1/docker/naver-crawler
            docker-compose pull
            docker-compose up -d
            docker-compose logs -f --tail=100 web
```

---

## ì˜ˆìƒ íš¨ê³¼

### ì •ëŸ‰ì  íš¨ê³¼

| ê°œì„  í•­ëª© | í˜„ì¬ | ëª©í‘œ | íš¨ê³¼ |
|----------|------|------|------|
| **í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€** | 0% | 80%+ | ë²„ê·¸ 70% ê°ì†Œ |
| **ë°°í¬ ì‹œê°„** | ìˆ˜ë™ 10ë¶„ | ìë™ 3ë¶„ | 70% ë‹¨ì¶• |
| **ì—ëŸ¬ ê°ì§€ ì‹œê°„** | ì‚¬ìš©ì ì œë³´ | ì‹¤ì‹œê°„ ì•Œë¦¼ | 90% ë¹ ë¦„ |
| **API ì‘ë‹µ ì‹œê°„** | 500-1000ms | 100-300ms | 70% ê°œì„  |
| **ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬** | N+1 ë¬¸ì œ | ìµœì í™” | 80% ë¹ ë¦„ |
| **ë²ˆë“¤ í¬ê¸°** | ~500KB | ~300KB | 40% ê°ì†Œ |

### ì •ì„±ì  íš¨ê³¼

1. **ì•ˆì •ì„± í–¥ìƒ**
   - ìë™ í…ŒìŠ¤íŠ¸ë¡œ íšŒê·€ ë²„ê·¸ ë°©ì§€
   - CI/CDë¡œ ë°°í¬ ì‹¤íŒ¨ ì‚¬ì „ ê°ì§€
   - ëª¨ë‹ˆí„°ë§ìœ¼ë¡œ ì¥ì•  ì¡°ê¸° ëŒ€ì‘

2. **ê°œë°œ ìƒì‚°ì„± í–¥ìƒ**
   - íƒ€ì… ì•ˆì „ì„±ìœ¼ë¡œ IDE ìë™ì™„ì„± ê°œì„ 
   - ì½”ë“œ í’ˆì§ˆ ë„êµ¬ë¡œ ë¦¬ë·° ì‹œê°„ ë‹¨ì¶•
   - í‘œì¤€í™”ëœ ì—ëŸ¬ ì²˜ë¦¬ë¡œ ë””ë²„ê¹… ìš©ì´

3. **ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ**
   - í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ë¬¸ì„œ ì—­í• 
   - êµ¬ì¡°í™”ëœ ë¡œê¹…ìœ¼ë¡œ ë¬¸ì œ ì¶”ì  ì‰¬ì›€
   - ìºì‹±ìœ¼ë¡œ ì„œë²„ ë¶€í•˜ ê°ì†Œ

4. **ë³´ì•ˆ ê°•í™”**
   - ì‹œí¬ë¦¿ ê´€ë¦¬ ìë™í™”
   - Rate Limitingìœ¼ë¡œ DDoS ë°©ì–´
   - Sentryë¡œ ë³´ì•ˆ ì´ìŠˆ ì¶”ì 

---

## ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ Quick Wins

### 1. ESLint ê·œì¹™ ê°•í™” (5ë¶„)
```bash
npm install --save-dev @typescript-eslint/eslint-plugin
```

```json
// .eslintrc.json
{
  "rules": {
    "@typescript-eslint/no-explicit-any": "error",
    "no-console": "warn"
  }
}
```

### 2. í™˜ê²½ ë³€ìˆ˜ ê²€ì¦ (10ë¶„)
```typescript
// lib/env.ts
import { z } from 'zod';

const envSchema = z.object({
  DATABASE_URL: z.string().url(),
  NEXTAUTH_SECRET: z.string().min(32),
});

export const env = envSchema.parse(process.env);
```

### 3. í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸ (15ë¶„)
```typescript
// app/api/health/route.ts
export async function GET() {
  try {
    await prisma.$queryRaw`SELECT 1`;
    return NextResponse.json({ status: 'healthy' });
  } catch {
    return NextResponse.json({ status: 'unhealthy' }, { status: 503 });
  }
}
```

### 4. Docker í—¬ìŠ¤ì²´í¬ ì¶”ê°€ (5ë¶„)
```yaml
# docker-compose.yml
services:
  web:
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
```

---

## ê²°ë¡ 

ì´ í”„ë¡œì íŠ¸ëŠ” **ê¸°ëŠ¥ì ìœ¼ë¡œëŠ” ë§¤ìš° ì˜ êµ¬í˜„**ë˜ì–´ ìˆìŠµë‹ˆë‹¤. í¬ë¡¤ë§ ë¡œì§, ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„, ì‚¬ìš©ì ê¸°ëŠ¥ ëª¨ë‘ í›Œë¥­í•©ë‹ˆë‹¤.

í•˜ì§€ë§Œ **í”„ë¡œë•ì…˜ ìš´ì˜ì„ ìœ„í•œ ê¸°ë°˜**ì´ ë¶€ì¡±í•©ë‹ˆë‹¤:
- âŒ í…ŒìŠ¤íŠ¸ ì—†ìŒ
- âŒ CI/CD ì—†ìŒ  
- âŒ ëª¨ë‹ˆí„°ë§ ì—†ìŒ
- âŒ ë³´ì•ˆ ê²€í†  ë¶€ì¡±

**ê¶Œì¥ ìš°ì„ ìˆœìœ„**:
1. í…ŒìŠ¤íŠ¸ + CI/CD (ê°€ì¥ ì¤‘ìš”!)
2. í™˜ê²½ ë³€ìˆ˜ ë³´ì•ˆ
3. ì—ëŸ¬ í•¸ë“¤ë§ í‘œì¤€í™”
4. ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”
5. ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ

ì´ ê°œì„ ì‚¬í•­ë“¤ì„ ìˆœì°¨ì ìœ¼ë¡œ ì ìš©í•˜ë©´, **ì•ˆì •ì ì´ê³  í™•ì¥ ê°€ëŠ¥í•œ í”„ë¡œë•ì…˜ ì‹œìŠ¤í…œ**ì„ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

**ì‘ì„±ì**: AI ì½”ë“œ ë¶„ì„ ì‹œìŠ¤í…œ  
**ë‚ ì§œ**: 2025-10-22  
**ë²„ì „**: 1.0.0

