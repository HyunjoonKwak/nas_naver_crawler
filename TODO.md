# 📋 프로젝트 TODO 리스트

> **마지막 업데이트**: 2025-10-25 (토요일)
> **현재 버전**: v2.12.0 - ✅ 실거래가 검색 기능 Phase 1~3 완료!
> **다음 작업**: 실거래가 기능 고도화 및 단지 상세 페이지 통합

---

## ✅ v2.12.0 실거래가 검색 기능 구현 완료! (2025-10-25)

**Phase 1~3 완료 요약:**
- ✅ 공공데이터포털 API 연동 준비 완료
- ✅ 백엔드 라이브러리 구현 ([lib/real-price-api.ts](lib/real-price-api.ts))
- ✅ API 라우트 구현 (2개)
  - `/api/real-price/search` - 지역/기간 기반 검색
  - `/api/real-price/complex` - 단지별 실거래가 조회
- ✅ 프론트엔드 검색 페이지 ([app/real-price/page.tsx](app/real-price/page.tsx))
- ✅ 네비게이션 메뉴 추가 (실거래가 메뉴)
- ✅ 사용 가이드 문서 작성 ([docs/REAL_PRICE_API.md](docs/REAL_PRICE_API.md))

**주요 기능:**
- 법정동코드/거래년월 기반 실거래가 검색
- 아파트명 필터링
- 실거래가 데이터 테이블 뷰 (거래금액, 면적, 층수, 주소 등)
- XML 응답 자동 파싱 및 가공
- Rate Limiting 대응 (요청 간 0.5초 대기)
- 서울시 법정동코드 매핑 (25개 구)

**설치된 패키지:**
- `xml2js`: XML 파싱 라이브러리
- `@types/xml2js`: TypeScript 타입 정의

---

## 🚀 현재 우선순위: 실거래가 기능 고도화

**목표**: 실거래가 데이터 시각화 및 크롤링 데이터 비교 기능

### Phase 1~3: ✅ 기본 구현 완료 (2025-10-25)
- ✅ 공공데이터포털 회원가입
- ✅ "아파트매매 실거래가" API 인증키 발급
- ✅ API 문서 분석 (요청/응답 형식)
- ✅ Rate Limiting 및 제한사항 확인
- ✅ 실거래가 API 라이브러리 구현 ([lib/real-price-api.ts](lib/real-price-api.ts))
- ✅ `/api/real-price/search` - 지역/기간 기반 검색
- ✅ `/api/real-price/complex` - 단지별 실거래가 조회
- ✅ 에러 처리 및 로깅
- ✅ 실거래가 검색 페이지 ([app/real-price/page.tsx](app/real-price/page.tsx))
- ✅ 검색 폼 컴포넌트 (지역, 기간, 단지명 필터)
- ✅ 검색 결과 테이블 구현

### Phase 4: 고도화 (2-3일) - 다음 단계
- [ ] 가격 추이 차트 (Recharts)
- [ ] 검색 결과 정렬 기능
- [ ] 페이지네이션 구현
- [ ] Redis 캐싱 전략 구현 (API 호출 최소화)
- [ ] 단지 상세 페이지에 실거래가 탭 추가

### Phase 5: 통합 및 비교 (2-3일)
- [ ] 크롤링 데이터 vs 실거래가 비교 뷰
- [ ] 차트 통합 (매물가 vs 실거래가)
- [ ] 내보내기 기능 (CSV, Excel)
- [ ] 전국 법정동코드 DB 구축

**현재 진행 상황**: Phase 3 완료 (3/5)
**남은 작업**: Phase 4~5 (예상 4-6일)

---

<details>
<summary>📜 v2.11.0 병합 절차 (완료됨 - 참고용)</summary>

### ✅ 병합 전 최종 체크리스트

#### 1️⃣ 24시간 안정성 확인
- ✅ 메모리 사용량 < 500MB (실제: 108MB)
- ✅ 크래시/재시작 없음
- ✅ 에러 로그 없음
- ✅ SSE 연결 정상 정리
- ✅ Redis 캐시 정상 작동

```bash
# NAS SSH 접속 후
ssh nas
cd /volume1/code_work/nas_naver_test

# 메모리 확인
docker stats --no-stream naver-crawler-web-test

# 에러 로그
docker logs naver-crawler-web-test 2>&1 | grep -i "error\|fatal\|crash"

# Uptime
docker ps | grep test
```

#### 2️⃣ 검증 스크립트 재실행
- ✅ 모든 테스트 통과 (15/15)

#### 3️⃣ 기능 테스트
- ✅ 로그인/로그아웃
- ✅ 단지 크롤링
- ✅ 알림 설정
- ✅ 대시보드 통계
- ✅ 단지 목록 조회

#### 4️⃣ GitHub Actions 확인
- ✅ CI/CD 파이프라인 모두 통과

### 🔀 병합 절차 (Squash Merge + 테스트 환경 완전 제거)

#### Step 1: Squash Merge로 main에 병합
```bash
# Git 저장소로 이동
cd /volume1/code_work/nas_naver_test

# main 브랜치로 전환 및 최신화
git checkout main
git pull origin main

# perf_improve의 모든 커밋을 하나로 합쳐서 병합
git merge --squash perf_improve

# 테스트 환경 전용 파일 제거
git rm docker-compose.test.yml

# 단일 커밋으로 생성
git commit -m "feat: v2.11.0 성능 최적화 및 인프라 개선

## 🎯 성능 최적화
- SSE 연결 관리 개선 (10분 타임아웃, heartbeat 패턴)
- 중복 크롤링 방지 (Redis 기반 상태 추적)
- 알림 쿼리 최적화 (N+1 제거, 크롤링 속도 20% 향상)

## 🏗️ 인프라 개선
- TypeScript 빌드 에러 완전 수정 (50+ 파일)
- NextAuth 세션 격리 (테스트/프로덕션)
- CI/CD 파이프라인 추가 (GitHub Actions)

## 📝 문서/스크립트 정리
- 중복 문서 제거 (10개 파일, 5,500줄)
- 스크립트 정리 (9개 파일, 697줄)
- 검증 자동화 스크립트 추가

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"

# main에 push
git push origin main
```

#### Step 2: 테스트 환경 완전 제거
```bash
# 컨테이너 + 볼륨 + 네트워크 모두 제거
docker-compose -f docker-compose.test.yml down -v

# 테스트 데이터 디렉토리 제거
rm -rf crawled_data_test logs_test

# 확인
docker ps -a | grep test          # 컨테이너 없어야 함
docker volume ls | grep test      # 볼륨 없어야 함
ls -la | grep test                # 디렉토리 없어야 함
```

#### Step 3: 프로덕션 배포
```bash
# 프로덕션 저장소로 이동
cd /volume1/code_work/nas_naver_crawler

# 최신 코드 pull
git pull origin main

# 재빌드 및 재시작
./manage.sh rebuild
```

#### Step 4: 프로덕션 검증 (중요!)
```bash
# 상태 확인
./manage.sh status

# 로그 실시간 모니터링
docker logs -f naver-crawler-web

# 웹 브라우저 테스트
# http://175.125.204.97:3000
```

**검증 항목:**
- ✅ 로그인/로그아웃 정상 동작
- ✅ 크롤링 정상 동작
- ✅ 알림 설정 정상 동작
- ✅ 대시보드 통계 표시
- ✅ 메모리 사용량: 108MB (목표 < 500MB)
- ✅ 에러 로그 없음

#### Step 5: perf_improve 브랜치 정리 (선택)
- 향후 필요시 정리 예정

</details>

---

## 🎯 최근 완료 항목 (2025-10-24 - v2.11.0 perf_improve)

### ✅ 성능 최적화 및 인프라 개선 (perf_improve 브랜치)

#### 10. 핵심 성능 이슈 해결 ✅ 완료 (2025-10-24)
- ✅ **SSE 연결 관리 개선**
  - 10분 타임아웃으로 메모리 누수 방지
  - Heartbeat 패턴으로 연결 상태 모니터링
  - 비활성 연결 자동 정리

- ✅ **중복 크롤링 방지**
  - Redis 기반 크롤링 상태 추적
  - 동시 크롤링 차단 (409 Conflict)
  - 3분 TTL 자동 해제

- ✅ **알림 쿼리 최적화**
  - N+1 쿼리 제거 (N×2 → 1 쿼리)
  - Prisma include로 단일 쿼리 변환
  - 크롤링 속도 20% 향상

#### 11. 인프라 및 개발 환경 개선 ✅ 완료 (2025-10-24)
- ✅ **테스트 환경 완전 분리**
  - 프로덕션(3000) / 테스트(3001) 독립 운영
  - 별도 DB (naver_crawler / naver_crawler_test)
  - 별도 Redis (6379 / 6380)
  - NEXTAUTH_SECRET 분리로 세션 충돌 방지

- ✅ **TypeScript 엄격 모드 완전 지원**
  - 50+ 파일 타입 에러 수정
  - catch 블록 타입 명시
  - Prisma 타입 변환 정확성 개선
  - getServerSession 타입 캐스팅

- ✅ **CI/CD 파이프라인**
  - GitHub Actions: 린트, 타입 체크, 테스트
  - Docker 빌드 자동화
  - PR 체크 자동화

#### 12. 문서화 및 자동화 ✅ 완료 (2025-10-24)
- ✅ **문서 대폭 정리**
  - 18개 → 8개 문서로 통합 (5,500줄 감소)
  - 중복 제거 및 핵심만 유지
  - v2.11.0 내용 업데이트

- ✅ **스크립트 정리**
  - 14개 → 5개 스크립트 (697줄 감소)
  - 핵심 유틸리티만 유지

- ✅ **검증 자동화**
  - `scripts/verify-perf-improve.sh` 생성
  - 15개 항목 자동 검증
  - 종합 테스트 가이드 (TESTING_CHECKLIST.md)

- ✅ **배포 가이드 업데이트**
  - NextAuth 세션 문제 해결 과정 문서화
  - BTRFS 파일시스템 이슈 해결 방법
  - 테스트 환경 세팅 가이드

---

### ✅ Phase 3: Analytics & Optimization (4-8주) ⭐⭐⭐⭐⭐

#### 8. 데이터 구조 개선 ✅ 완료 (2025-10-19)
- ✅ Article 테이블에 숫자 가격 컬럼 추가 (dealOrWarrantPrcWon, rentPrcWon)
- ✅ 가격 인덱스 추가 (빠른 정렬/필터링)
- ✅ 시계열 인덱스 추가 (createdAt)
- ✅ 마이그레이션 SQL 파일 생성
- ✅ 데이터 마이그레이션 스크립트 작성 (scripts/migrate-price-data.ts)

#### 9. 대시보드 분석 API ✅ 완료 (2025-10-19)
- ✅ 전체 통계 API 구현 (/api/analytics/dashboard)
- ✅ 5가지 분석 데이터 제공:
  - 시장 개요 KPI (총 매물, 평균/최저/최고 가격)
  - 가격 추이 (최근 30일 일별)
  - 단지별 순위 (TOP 10)
  - 거래 유형 분포
  - 평형별 분석

### ✅ Phase 2 완료: Core Features (2-4주) ⭐⭐⭐⭐

#### 6. 알림 시스템 고도화 ✅ 완료 (2025-10-19)
- ✅ 알림 설정 페이지 UI 구현
- ✅ 알림 목록/생성/삭제 기능
- ✅ 알림 활성화/비활성화 토글
- ✅ 단지별 알림 조건 설정 (가격, 면적, 거래유형)

#### 7. 24시간 매물 변동 추이 ✅ 완료 (2025-10-19)
- ✅ API에 24시간 매물 변동 계산 추가
- ✅ 단지 카드에 변동 표시 (+N개 배지)
- ✅ 변동 있는 단지 하이라이트 (green border)
- ✅ 리스트 뷰에도 변동 배지 표시

#### 4. 고급 필터링 ✅ 완료 (2025-10-19)
- ✅ 가격대 필터 (전체/3억 이하/3-5억/5-10억/10억 이상)
- ✅ 매물 수 필터 (전체/매물 없음/1-10개/10-50개/50개 이상)
- ✅ 필터 UI (Action Bar 내 드롭다운)
- ✅ 필터 결과 카운트 표시
- ✅ 필터 초기화 기능
- ✅ 빈 결과 처리

#### 5. 단지 비교 기능 ✅ 완료 (2025-10-19)
- ✅ 비교 모드 토글 버튼
- ✅ 체크박스 선택 UI (2-5개 선택 가능)
- ✅ 비교 모드 안내 배너
- ✅ 선택된 카드 시각적 표시 (purple ring)
- ✅ 비교 모달 (side-by-side 테이블)
- ✅ 항목별 비교 (단지번호, 가격, 매물수, 세대수, 동수, 주소, 거래유형별 통계)
- ✅ 상세보기 링크

### ✅ Phase 1 완료: Quick Wins (1-2주) ⭐⭐⭐⭐⭐

#### 1. 단지목록 페이지 정보 강화
- ✅ 가격 통계 유틸리티 (`lib/price-utils.ts`)
  - ✅ 가격 문자열 파싱 (예: "3억 5,000" → 350000000원)
  - ✅ 가격 포맷팅 (원 → 억/만원 형식)
  - ✅ 매물 가격 통계 계산 (평균/최저/최고)
  - ✅ 거래 유형별 통계 계산
- ✅ API 개선 (`/api/complexes`)
  - ✅ 최근 100개 매물 조회 (가격 통계 계산용)
  - ✅ `priceStats` 추가 (평균가, 최저가, 최고가)
  - ✅ `tradeTypeStats` 추가 (거래 유형별 통계)
- ✅ 카드 뷰 정보 개선
  - ✅ 가격 정보 섹션 (평균/최저/최고)
  - ✅ 거래 유형별 통계 섹션 (매매/전세/월세)
- ✅ 리스트 뷰 컬럼 재구성
  - ✅ "평균 가격" 컬럼 추가
  - ✅ 가격 범위 표시 (최저~최고)
- ✅ 상단 전체 통계 대시보드 (5개 KPI)
  - ✅ 총 단지 수, 총 매물 수
  - ✅ 평균/최저/최고 가격
  - ✅ 그라데이션 디자인

### ✅ 이전 완료 항목 (2025-10-18 ~ 2025-10-19)

#### 커뮤니티 시스템 구축 완료
- ✅ 게시판 기능 (자유게시판, Q&A, 공지사항)
- ✅ 댓글 & 대댓글 (nested replies)
- ✅ 게시글 북마크
- ✅ 좋아요 시스템
- ✅ 신고 시스템 (게시글/댓글)
- ✅ 알림 시스템
- ✅ 관리자 페이지 (신고 관리)

#### 크롤러 안정성 개선
- ✅ 컨텍스트 파괴 에러 자동 복구
- ✅ 컨테이너 감지 로직 개선
- ✅ 초기 매물 0개 검증 로직 추가
- ✅ 스케줄러 HTTP 타임아웃 버퍼 추가

#### UI/UX 개선
- ✅ Lucide React 아이콘 전환
- ✅ 커뮤니티 페이지 폰트 크기 최적화 (70%)
- ✅ 커뮤니티 페이지 중앙 정렬 레이아웃
- ✅ 단지 목록에 등록일/최근수집일 표시

---

## 📈 Phase 1: Quick Wins (1-2주)

### 🔴 높은 우선순위

#### 1. ~~단지목록 페이지 정보 강화~~ ⭐⭐⭐⭐⭐ ✅ 완료
**임팩트**: 매우 높음 | **소요**: 2-3일 | **상태**: ✅ 완료 (2025-10-19)

- ✅ API에 가격 통계 추가 (평균가, 최저가, 최고가)
- ✅ 카드 뷰 정보 개선
  - ✅ 평균 매매가 표시
  - ✅ 가격 범위 (최저~최고)
  - ✅ 거래 유형별 통계
- ✅ 리스트 뷰 컬럼 재구성
- ✅ 상단 전체 통계 대시보드 (5개 KPI)

**완료 커밋**: [01fcfd7](../../commit/01fcfd7)

#### 2. ~~홈 페이지 개선~~ ⭐⭐⭐ ✅ 부분 완료
**임팩트**: 높음 | **소요**: 1-2일 | **상태**: ✅ KPI 카드는 이미 구현됨

- ✅ 상단 KPI 카드 4개 (이미 구현됨: 관심 단지, 등록 단지, 수집 매물, 최근 수집)
- ⏸️ 관심 단지 카드에 미니 차트 (7일 매물 추이) - Phase 2로 연기
- ⏸️ 필터/정렬 옵션 - Phase 2로 연기

#### 3. ~~랜딩 페이지 최적화~~ ⭐⭐⭐ ✅ 완료
**임팩트**: 중간 | **소요**: 0.5일 | **상태**: ✅ 완료 (2025-10-19)

- ✅ 실시간 통계 표시 (등록 매물, 관리 단지, 평균 업데이트 시간)
- ✅ 기능 카드 축소 (6개 → 3개 핵심만)
- ✅ 회원가입 CTA 강화

**완료 커밋**: [3d2a9a6](../../commit/3d2a9a6)

---

## 📊 Phase 2: Core Features (2-4주)

### 🟡 중간 우선순위

#### 4. ~~고급 필터링~~ ⭐⭐⭐⭐ ✅ 완료
**임팩트**: 높음 | **소요**: 0.5일 | **상태**: ✅ 완료 (2025-10-19)

- ✅ 가격대 필터 (전체/3억 이하/3-5억/5-10억/10억 이상)
- ✅ 매물 수 필터 (전체/매물 없음/1-10개/10-50개/50개 이상)
- ⏸️ 평형대 필터 - 추후 구현 (평형 데이터 필요)
- ⏸️ 복합 필터 (AND/OR) - 추후 구현

**구현 파일**: [app/complexes/page.tsx:141-206](app/complexes/page.tsx#L141-L206)

#### 5. ~~단지 비교 기능~~ ⭐⭐⭐⭐ ✅ 완료
**임팩트**: 높음 | **소요**: 1일 | **상태**: ✅ 완료 (2025-10-19)

- ✅ 비교 모드 토글 & 체크박스 선택 UI
- ✅ 비교 모달 (side-by-side 테이블)
- ✅ 항목별 비교 테이블 (9개 항목)
- ⏸️ 비교 차트 - Phase 3로 연기

**구현 파일**: [app/complexes/page.tsx:1915-2138](app/complexes/page.tsx#L1915-L2138)

#### 6. ~~알림 시스템 고도화~~ ⭐⭐⭐ ✅ 완료
**임팩트**: 중간 | **소요**: 0.5일 | **상태**: ✅ 완료 (2025-10-19)

- ✅ 알림 설정 페이지 UI 구현
- ✅ 알림 목록 조회/생성/삭제 기능
- ✅ 알림 활성화/비활성화 토글
- ⏸️ 가격 변동 감지 로직 - 백그라운드 작업 필요
- ⏸️ 새 매물 감지 로직 - 백그라운드 작업 필요
- ⏸️ 이메일/웹훅 발송 - 준비 중

**구현 파일**:
- [app/alerts/page.tsx](app/alerts/page.tsx) - 알림 설정 페이지
- [app/api/alerts/route.ts](app/api/alerts/route.ts) - 알림 API (기존)

#### 7. ~~24시간 매물 변동 추이~~ ⭐⭐⭐ ✅ 완료
**임팩트**: 중간 | **소요**: 0.5일 | **상태**: ✅ 완료 (2025-10-19)

- ✅ API에 24시간 매물 변동 계산 추가
- ✅ 단지 카드에 변동 표시 (+N개)
- ✅ 변동 있는 단지 하이라이트 (green border)

**구현 파일**:
- [app/api/complexes/route.ts:125-130](app/api/complexes/route.ts#L125-L130)
- [app/complexes/page.tsx:1504-1508](app/complexes/page.tsx#L1504-L1508)

---

## 🚀 Phase 3: Analytics (4-8주)

### 🟢 낮은 우선순위 (장기)

#### 7. 데이터 분석 페이지 ⭐⭐⭐⭐⭐
- [ ] `/analytics` 페이지 생성
- [ ] 시장 개요 (KPI)
- [ ] 가격 추이 차트 (Line Chart)
- [ ] 단지별 순위 (TOP 10)
- [ ] 거래 유형 분포 (Pie Chart)
- [ ] 평형별 분석 (Bar Chart)

**필요 기술**: Recharts, 분석 API

**참고**: [ANALYSIS_REPORT.md](ANALYSIS_REPORT.md#-4-데이터-분석-페이지-미구현)

#### 8. 데이터 구조 개선 ⭐⭐⭐⭐
- [ ] Article 테이블에 숫자 가격 컬럼 추가
- [ ] 기존 문자열 데이터 마이그레이션
- [ ] 인덱스 추가

**장점**: SQL 통계 계산, 필터링 속도 10배 향상

#### 9. 지도 통합 ⭐⭐⭐
- [ ] Naver Maps API 연동
- [ ] 단지 위치 마커
- [ ] 가격 기준 히트맵
- [ ] 클러스터링

---

## 🔧 기술 부채 & 최적화

### 성능
- [ ] React Query 도입
- [ ] 단지목록 컴포넌트 분리 (1671줄 → 500줄 이하)
- [ ] Virtual Scrolling
- [ ] 이미지 최적화

### 보안
- [ ] Rate Limiting
- [ ] CSRF 보호
- [ ] XSS 방어

### 문서
- [ ] API 문서 (Swagger)
- [ ] 사용자 가이드
- [ ] 개발자 가이드

---

## 🎯 이번 주 목표 (2025-10-20 ~ 2025-10-26)

1. ✅ 단지목록 페이지 정보 강화 시작
2. ✅ 홈 페이지 KPI 카드 추가
3. ✅ 랜딩 페이지 간소화

---

## 📊 프로젝트 통계

| 카테고리 | 완료 | 진행률 |
|---------|------|--------|
| 페이지 | 9/11 | 82% |
| 컴포넌트 | 20/25 | 80% |
| API | 45/60 | 75% |
| 핵심 기능 | 8/12 | 67% |

---

**상세 분석**: [ANALYSIS_REPORT.md](ANALYSIS_REPORT.md)
**마지막 업데이트**: 2025-10-19
**상태**: 🚀 활발히 개발 중
